<?xml version="1.0" encoding="UTF-8"?>
<thing:thing-descriptions bindingId="stecagrid"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
	xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">

	<thing-type id="stecagrid_inverter">
		<label>StecaGrid Inverter</label>
		<description>This thing represents a StecaGrid inverter. The provided channels are based upon the fields available in
			the 3611 model. Availability of the data might depend on the model and the physical installation details of the
			device.</description>

        <channel-groups>
            <channel-group id="inverter" typeId="inverterGroup"/>
            <channel-group id="grid" typeId="gridGroup"/>
            <channel-group id="yield" typeId="yieldGroup"/>
        </channel-groups>

        <properties>
            <property name="deviceName">N/A</property>
            <property name="deviceType">N/A</property>
            <property name="deviceNominalPower">N/A</property>
        </properties>

		<config-description>
			<parameter name="ipAddress" type="text" required="true">
				<label>Network Address</label>
				<description>The IP or host name of the inverter.</description>
				<context>network-address</context>
			</parameter>
			<parameter name="measurementInterval" type="integer" min="1">
				<label>Measurement refresh Interval</label>
				<description>Number of seconds between refreshing the measurement values.</description>
				<default>30</default>
			</parameter>

            <parameter name="yieldInterval" type="integer" min="1">
                <label>Yield refresh interval</label>
                <description>Number of seconds between refreshing the daily yield values.</description>
                <default>300</default>
            </parameter>
		</config-description>
	</thing-type>

    <channel-group-type id="inverterGroup">
        <label>Inverter Data</label>
        <description>Current measurements from the inverter</description>
        <channels>
            <channel id="ac_voltage" typeId="ac_voltage"/>
            <channel id="ac_current" typeId="ac_current"/>
            <channel id="ac_power" typeId="ac_power"/>
            <channel id="ac_power_fast" typeId="ac_power_fast"/>
            <channel id="ac_frequency" typeId="ac_frequency"/>
            <channel id="dc_voltage" typeId="dc_voltage"/>
            <channel id="dc_current" typeId="dc_current"/>
            <channel id="link_voltage" typeId="link_voltage"/>
            <channel id="derating" typeId="derating"/>
        </channels>
    </channel-group-type>

    <channel-group-type id="gridGroup">
        <label>Grid</label>
        <description>Grid Statistics</description>
        <channels>
            <channel id="grid_power" typeId="grid_power"/>
            <channel id="grid_consumed_power" typeId="grid_consumed_power"/>
            <channel id="grid_injected_power" typeId="grid_injected_power"/>
            <channel id="own_consumed_power" typeId="own_consumed_power"/>
        </channels>
    </channel-group-type>

    <channel-group-type id="yieldGroup">
        <label>Yield</label>
        <description>Yield Statistics</description>
        <channels>
            <channel id="yield_day_current" typeId="yield_day_current"/>
            <channel id="yield_day_previous" typeId="yield_day_previous"/>
            <channel id="yield_last_30_days" typeId="yield_last_30_days"/>
        </channels>
    </channel-group-type>

	<channel-type id="ac_voltage">
		<item-type>Number:ElectricPotential</item-type>
		<label>AC Voltage</label>
		<description>This channel provides the current AC Voltage in V.</description>
		<category>Energy</category>
        <state readOnly="true" pattern="%.0f V"/>
	</channel-type>

    <channel-type id="ac_current">
        <item-type>Number:ElectricCurrent</item-type>
        <label>AC Current</label>
        <description>This channel currently provides the current AC Current in A.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.3f A"/>
    </channel-type>

    <channel-type id="ac_power">
        <item-type>Number:Power</item-type>
        <label>AC Power</label>
        <description>This channel provides the current AC Power in W.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.0f W"/>
    </channel-type>

    <channel-type id="ac_power_fast">
        <item-type>Number:Power</item-type>
        <label>AC Power Fast</label>
        <description>This channel provides the current AC Power Fast in W.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.0f W"/>
    </channel-type>

    <channel-type id="ac_frequency">
        <item-type>Number:Frequency</item-type>
        <label>AC Frequency</label>
        <description>This channel provides the current AC Frequency in Hz.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.1f Hz"/>
    </channel-type>

    <channel-type id="dc_voltage">
        <item-type>Number:ElectricPotential</item-type>
        <label>DC Voltage</label>
        <description>This channel provides the current DC Voltage in V.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.0f V"/>
    </channel-type>

    <channel-type id="dc_current">
        <item-type>Number:Power</item-type>
        <label>DC Current</label>
        <description>This channel provides the current DC Current in A.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.3f A"/>
    </channel-type>

    <channel-type id="link_voltage">
        <item-type>Number:ElectricPotential</item-type>
        <label>Link Voltage</label>
        <description>This channel provides the current Link Voltage in V.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.0f V"/>
    </channel-type>

    <channel-type id="yield_day_current">
        <item-type>Number:Energy</item-type>
        <label>Yield Today</label>
        <description>This channel provides the current yield for the current day in KWh.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.3f KWh"/>
    </channel-type>

    <channel-type id="yield_day_previous">
        <item-type>Number:Energy</item-type>
        <label>Yield Yesterday</label>
        <description>This channel provides yesterdays total yield in KWh.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.3f KWh"/>
    </channel-type>

    <channel-type id="yield_last_30_days">
        <item-type>Number:Energy</item-type>
        <label>Yield Last 30 Days</label>
        <description>This channel provides the yield over the last 30 days (excluding today).</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.3f KWh"/>
    </channel-type>

    <channel-type id="grid_power">
        <item-type>Number:Power</item-type>
        <label>Grid Power</label>
        <description>This channel provides the Grid Power. Disclaimer: Untested, always zero for the developer.</description>
        <category>Energy</category>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="grid_consumed_power">
        <item-type>Number:Power</item-type>
        <label>Grid Consumed Power</label>
        <description>This channel provides the Grid Consumed Power. Disclaimer: Untested, always zero for the developer. The intention seems to be to log the imported energy from the grid (despite 'power' in the name and 'W' as unit).</description>
        <category>Energy</category>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="grid_injected_power">
        <item-type>Number:Power</item-type>
        <label>Grid Injected Power</label>
        <description>This channel provides the Grid Injected Power. Disclaimer: Untested, always zero for the developer. The intention seems to be to log the exported energy into the grid (despite 'power' in the name and 'W' as unit).</description>
        <category>Energy</category>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="own_consumed_power">
        <item-type>Number:Power</item-type>
        <label>Own Consumed Power</label>
        <description>This channel provides the Own Consumed Power. Disclaimer: Untested, always zero for the developer. The intention seems to be to log the produced energy that was directly used (despite 'power' in the name and 'W' as unit).</description>
        <category>Energy</category>
        <state readOnly="true"/>
    </channel-type>
    
    <channel-type id="derating">
        <item-type>Number</item-type>
        <label>Derating</label>
        <description>This channel provides the current derating as a percentage, where 0 means fully derated and 100 means not
            derated.</description>
        <category>Energy</category>
        <state readOnly="true" pattern="%.0f %%"/>
    </channel-type>
    

</thing:thing-descriptions>
